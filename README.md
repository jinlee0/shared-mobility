# Shared Mobility
따릉이(서울시 공공자전거) 공공데이터를 이용하여 공유 모빌리티 서비스를 구현해봅니다.

## 사용 기술
`Kotlin`, `MySql`, `Docker`, `Kafka`, </br>

`Spring-Boot 3`, `Spring Security` `Spring Data Jpa`, `QueryDsl`, </br>

## 주요 기능
- 회원
    - 회원가입
- 대여소
    - 조회: 사용자의 현 위치 또는 임의의 위치를 기준으로 주변 대여소를 조회합니다.
    - 즐겨찾기: 사용자는 특정 대여소를 즐겨찾기에 등록하고 조회할 수 있습니다.
- 결제
    - 결제수단 등록: 사용자는 결제수단을 등록하고 결제 시 사용할 수 있습니다.
    - 이용권 구매: 사용자는 등록된 결제수단으로 이용권을 구매할 수 있습니다.
- 대여: 사용자는 대여소에 거치되어있는 따릉이의 QR을 앱 카메라로 스캔하여 따릉이를 대여합니다.
- 반납: 사용자는 대여소에서 따릉이를 거치대에 거치 후 잠금장치를 작동하여 반납합니다.
- 추가요금 자동결제: 시간 초과로 인한 추가요금 발생 시 등록된 결제수단으로 자동결제됩니다.

## 데이터
- 대여소 데이터:
    - 서울시 열린데이터 광장의 '서울시 따릉이대여소 마스터 정보'로 대여소(station) 데이터를 채웁니다.
    - '서울시 공공자전거 실시간 대여정보' API를 통해 실시간 대여소 정보를 다룹니다.

## 정책
- 이메일 하나 당 하나의 계정을 가질 수 있습니다.
- 첫 결제 시 결제수단으로 사용자의 개인정보(카드번호)를 저장합니다. 사용자는 자신의 결제수단을 조회할 수 있지만 개인정보는 블러처리되어 조회됩니다.
- 이용권
    - 일일권(1h-1000, 2h-2000),
    - 정기권 1h(7d-3000, 30d-5000, 180d-15000, 365d-30000)
    - 정기권 2h(7d-4000, 30d-7000, 180d-20000, 365d-40000)
- 시간 초과 시 5분당 200원의 추가요금이 있습니다. 추가요금은 등록된 결제수단으로 자동 결제됩니다.
- 대여 시 사용자의 모바일 앱으로부터 사용자의 위치를, 따릉이의 단말로부터 따릉이의 위치를 받아 거리 차이가 100m 이하인 경우에 대여 가능합니다.
- 사용자는 한 번에 하나의 따릉이만 대여할 수 있습니다.
- 따릉이는 한 번에 한 명의 사용자에게만 대여될 수 있습니다.
- 이용권의 사용기한은 해당 이용권으로 처음 대여한 시점으로부터 계산합니다.

## 대여 구현 계획 (Kafka)
- 사용자는 따릉이의 모바일 앱 카메라로 QR를 찍는다.
- 서버는 대여신청(사용자의 위치, 자전거 번호) 정보를 저장하고 자전거 번호에 해당하는 `대여신청` 이벤트를 발행한다.
- 따릉이 단말기는 `대여신청`이벤트를 구독하고 있으며, 이벤트의 자전거 번호가 자신의 것일 경우 서버로 단말기의 현재 위치를 포함한 대여확인 요청을 보낸다.
- 서버는 사용자의 위치와 단말기의 위치가 100m 이내인 경우 성공(대여실행)을, 그렇지 않은경우 실패(반려) 한다.

## ERD
![image](https://github.com/jinlee0/shared-mobility/assets/74762475/323e36aa-910f-4a6d-9061-8fde6276189a)
